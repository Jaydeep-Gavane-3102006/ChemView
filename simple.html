<!DOCTYPE html>
<html lang="en" ng-app="molecularVisualizer">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Molecular & Atomic Structure Visualizer - AngularJS</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== APP CONTAINER ===== */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER ===== */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 0;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 300;
            background: linear-gradient(45deg, #00d4ff, #7b2ff7, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
            font-weight: 300;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
        }

        /* ===== CONTROL PANEL ===== */
        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        /* ===== MODE SELECTOR ===== */
        .mode-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .mode-btn {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #00d4ff, #7b2ff7);
            border-color: transparent;
            box-shadow: 0 4px 20px rgba(123, 47, 247, 0.3);
        }

        /* ===== FORM CONTROLS ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #a0a0a0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #00d4ff;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00d4ff, #7b2ff7);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(123, 47, 247, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        /* ===== VIEWER CONTROLS ===== */
        .viewer-controls {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-select {
            width: 100%;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 0.9rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a0a0a0;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* ===== VIEWER SECTION ===== */
        .viewer-section {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .viewer-container {
            width: 100%;
            height: 600px;
            position: relative;
        }

        /* ===== LOADING OVERLAY ===== */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 12, 41, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #a0a0a0;
            font-size: 1rem;
        }

        /* ===== INFO PANEL ===== */
        .info-panel {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            min-width: 250px;
            max-width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .info-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #00d4ff;
        }

        .info-details p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .info-details strong {
            color: #a0a0a0;
            font-weight: 500;
        }

        /* ===== ELEMENT DROPDOWN ===== */
        .element-dropdown-section {
            margin-top: 1rem;
        }

        .element-info {
            margin-top: 1.5rem;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .element-title {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #00d4ff;
        }

        .element-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .element-details p {
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
        }

        .element-details strong {
            color: #a0a0a0;
            font-weight: 500;
            min-width: 120px;
            display: inline-block;
        }

        /* ===== ERROR MESSAGES ===== */
        .error-message {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid rgba(255, 59, 48, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            color: #ff6b6b;
            font-size: 0.9rem;
        }

        /* ===== SUCCESS MESSAGE ===== */
        .success-message {
            background: rgba(52, 199, 89, 0.2);
            border: 1px solid rgba(52, 199, 89, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            color: #34c759;
            font-size: 0.9rem;
        }

        /* ===== COMMON MOLECULES ===== */
        .common-molecules {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 0.9rem;
            color: #a0a0a0;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .molecule-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .molecule-chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .molecule-chip:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            transform: translateY(-1px);
        }

        .molecule-chip strong {
            color: #00d4ff;
            font-family: 'Courier New', monospace;
        }

        .molecule-name {
            color: #a0a0a0;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }
            
            .control-panel {
                order: 2;
            }
            
            .viewer-section {
                order: 1;
            }
            
            .viewer-container {
                height: 400px;
            }
            
            .title {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .control-panel {
                padding: 1.5rem;
            }
            
            .mode-selector {
                flex-direction: column;
            }
            
            .info-panel {
                position: static;
                margin-top: 1rem;
                max-width: 100%;
            }
            
            .viewer-container {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .viewer-container {
                height: 250px;
            }
        }

        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ===== CANVAS STYLING ===== */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }
    </style>
</head>
<body ng-controller="MainController as vm">
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">3D Molecular & Atomic Structure Visualizer</h1>
                <p class="subtitle">Interactive Chemistry Visualization Platform - AngularJS</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Control Panel -->
            <section class="control-panel">
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <button class="mode-btn" 
                            ng-class="{active: vm.mode === 'molecule'}"
                            ng-click="vm.setMode('molecule')">
                        <span>‚öóÔ∏è</span> Molecule Mode
                    </button>
                    <button class="mode-btn" 
                            ng-class="{active: vm.mode === 'atom'}"
                            ng-click="vm.setMode('atom')">
                        <span>‚öõÔ∏è</span> Atomic Mode
                    </button>
                </div>

                <!-- Molecule Input Section -->
                <div ng-show="vm.mode === 'molecule'" class="molecule-input-section">
                    <div class="form-group">
                        <label class="form-label">Chemical Formula:</label>
                        <input type="text" ng-model="vm.formula" class="form-input" 
                               placeholder="Enter formula (e.g., H2O, CO2, CH4)"
                               ng-keypress="vm.handleKeyPress($event)">
                    </div>
                    
                    <button class="btn btn-primary" ng-click="vm.generateMolecule()">
                        <span>üß™</span> Generate Molecule
                    </button>
                    
                    <!-- Common Molecules -->
                    <div class="common-molecules">
                        <h4 class="section-title">Common Molecules:</h4>
                        <div class="molecule-chips">
                            <div class="molecule-chip" ng-click="vm.loadMolecule('H2O')">
                                <strong>H2O</strong>
                                <span class="molecule-name">Water</span>
                            </div>
                            <div class="molecule-chip" ng-click="vm.loadMolecule('CO2')">
                                <strong>CO2</strong>
                                <span class="molecule-name">Carbon Dioxide</span>
                            </div>
                            <div class="molecule-chip" ng-click="vm.loadMolecule('CH4')">
                                <strong>CH4</strong>
                                <span class="molecule-name">Methane</span>
                            </div>
                            <div class="molecule-chip" ng-click="vm.loadMolecule('NH3')">
                                <strong>NH3</strong>
                                <span class="molecule-name">Ammonia</span>
                            </div>
                            <div class="molecule-chip" ng-click="vm.loadMolecule('O2')">
                                <strong>O2</strong>
                                <span class="molecule-name">Oxygen</span>
                            </div>
                            <div class="molecule-chip" ng-click="vm.loadMolecule('N2')">
                                <strong>N2</strong>
                                <span class="molecule-name">Nitrogen</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Element Dropdown Section -->
                <div ng-show="vm.mode === 'atom'" class="element-dropdown-section">
                    <div class="form-group">
                        <label class="form-label">Select Element:</label>
                        <select class="control-select" ng-model="vm.selectedElement" ng-change="vm.onElementChange()">
                            <option value="">Choose an element...</option>
                            <option ng-repeat="element in vm.allElements" 
                                    value="{{element.symbol}}"
                                    ng-bind="element.atomicNumber + ' - ' + element.name + ' (' + element.symbol + ')'">
                            </option>
                        </select>
                    </div>
                    
                    <div class="element-info" ng-show="vm.selectedElement && vm.getSelectedElementData()">
                        <div class="info-card">
                            <h4 class="element-title">{{vm.getSelectedElementData().name}} ({{vm.getSelectedElementData().symbol}})</h4>
                            <div class="element-details">
                                <p><strong>Atomic Number:</strong> {{vm.getSelectedElementData().atomicNumber}}</p>
                                <p><strong>Atomic Mass:</strong> {{vm.getSelectedElementData().atomicMass}}</p>
                                <p><strong>Category:</strong> {{vm.getSelectedElementData().category}}</p>
                                <p><strong>Electron Config:</strong> {{vm.getSelectedElementData().electronConfig}}</p>
                                <p><strong>Period:</strong> {{vm.getSelectedElementData().period}}</p>
                                <p><strong>Group:</strong> {{vm.getSelectedElementData().group}}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="viewer-controls">
                    <div class="control-group">
                        <button class="btn btn-secondary" ng-click="vm.takeScreenshot()">
                            <span>üì∏</span> Screenshot
                        </button>
                        <button class="btn btn-secondary" ng-click="vm.resetView()">
                            <span>üîÑ</span> Reset View
                        </button>
                    </div>
                </div>

                <!-- Messages -->
                <div ng-show="vm.errorMessage" class="error-message">
                    {{vm.errorMessage}}
                </div>
                <div ng-show="vm.successMessage" class="success-message">
                    {{vm.successMessage}}
                </div>
            </section>

            <!-- 3D Viewer Section -->
            <section class="viewer-section">
                <!-- Loading Indicator -->
                <div ng-show="vm.isLoading" class="loading-overlay">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">Rendering 3D Structure...</p>
                </div>

                <!-- Viewer Container -->
                <div class="viewer-container" id="viewerContainer"></div>

                <!-- Info Panel -->
                <div ng-show="vm.showInfo" class="info-panel">
                    <div class="info-content">
                        <h3 class="info-title">{{vm.infoTitle}}</h3>
                        <div class="info-details" ng-bind-html="vm.infoDetails"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // ===== ANGULARJS APPLICATION =====
        angular.module('molecularVisualizer', [])
            .controller('MainController', ['$scope', '$timeout', '$sce', function($scope, $timeout, $sce) {
                var vm = this;
                
                // Controller state
                vm.mode = 'molecule';
                vm.formula = '';
                vm.displayModel = 'ball-stick';
                vm.autoRotate = false;
                vm.isLoading = false;
                vm.errorMessage = '';
                vm.successMessage = '';
                vm.showInfo = false;
                vm.infoTitle = '';
                vm.infoDetails = '';
                vm.currentMolecule = null;
                
                // Three.js variables
                var scene, camera, renderer, controls;
                var meshes = [];
                var lights = [];
                var animationId;
                var isAutoRotating = false;
                var displayModel = 'ball-stick';
                
                // ===== ELEMENT DATA (118 ELEMENTS) =====
                var elements = [
                    // Period 1
                    {atomicNumber: 1, symbol: 'H', name: 'Hydrogen', atomicMass: 1.008, category: 'nonmetal', electronConfig: '1s1', shells: [1], period: 1, group: 1},
                    {atomicNumber: 2, symbol: 'He', name: 'Helium', atomicMass: 4.003, category: 'noble-gas', electronConfig: '1s2', shells: [2], period: 1, group: 18},
                    
                    // Period 2
                    {atomicNumber: 3, symbol: 'Li', name: 'Lithium', atomicMass: 6.941, category: 'alkali-metal', electronConfig: '[He] 2s1', shells: [2, 1], period: 2, group: 1},
                    {atomicNumber: 4, symbol: 'Be', name: 'Beryllium', atomicMass: 9.012, category: 'alkaline-earth', electronConfig: '[He] 2s2', shells: [2, 2], period: 2, group: 2},
                    {atomicNumber: 5, symbol: 'B', name: 'Boron', atomicMass: 10.81, category: 'metalloid', electronConfig: '[He] 2s2 2p1', shells: [2, 3], period: 2, group: 13},
                    {atomicNumber: 6, symbol: 'C', name: 'Carbon', atomicMass: 12.01, category: 'nonmetal', electronConfig: '[He] 2s2 2p2', shells: [2, 4], period: 2, group: 14},
                    {atomicNumber: 7, symbol: 'N', name: 'Nitrogen', atomicMass: 14.01, category: 'nonmetal', electronConfig: '[He] 2s2 2p3', shells: [2, 5], period: 2, group: 15},
                    {atomicNumber: 8, symbol: 'O', name: 'Oxygen', atomicMass: 16.00, category: 'nonmetal', electronConfig: '[He] 2s2 2p4', shells: [2, 6], period: 2, group: 16},
                    {atomicNumber: 9, symbol: 'F', name: 'Fluorine', atomicMass: 19.00, category: 'halogen', electronConfig: '[He] 2s2 2p5', shells: [2, 7], period: 2, group: 17},
                    {atomicNumber: 10, symbol: 'Ne', name: 'Neon', atomicMass: 20.18, category: 'noble-gas', electronConfig: '[He] 2s2 2p6', shells: [2, 8], period: 2, group: 18},
                    
                    // Period 3
                    {atomicNumber: 11, symbol: 'Na', name: 'Sodium', atomicMass: 22.99, category: 'alkali-metal', electronConfig: '[Ne] 3s1', shells: [2, 8, 1], period: 3, group: 1},
                    {atomicNumber: 12, symbol: 'Mg', name: 'Magnesium', atomicMass: 24.31, category: 'alkaline-earth', electronConfig: '[Ne] 3s2', shells: [2, 8, 2], period: 3, group: 2},
                    {atomicNumber: 13, symbol: 'Al', name: 'Aluminum', atomicMass: 26.98, category: 'post-transition', electronConfig: '[Ne] 3s2 3p1', shells: [2, 8, 3], period: 3, group: 13},
                    {atomicNumber: 14, symbol: 'Si', name: 'Silicon', atomicMass: 28.09, category: 'metalloid', electronConfig: '[Ne] 3s2 3p2', shells: [2, 8, 4], period: 3, group: 14},
                    {atomicNumber: 15, symbol: 'P', name: 'Phosphorus', atomicMass: 30.97, category: 'nonmetal', electronConfig: '[Ne] 3s2 3p3', shells: [2, 8, 5], period: 3, group: 15},
                    {atomicNumber: 16, symbol: 'S', name: 'Sulfur', atomicMass: 32.07, category: 'nonmetal', electronConfig: '[Ne] 3s2 3p4', shells: [2, 8, 6], period: 3, group: 16},
                    {atomicNumber: 17, symbol: 'Cl', name: 'Chlorine', atomicMass: 35.45, category: 'halogen', electronConfig: '[Ne] 3s2 3p5', shells: [2, 8, 7], period: 3, group: 17},
                    {atomicNumber: 18, symbol: 'Ar', name: 'Argon', atomicMass: 39.95, category: 'noble-gas', electronConfig: '[Ne] 3s2 3p6', shells: [2, 8, 8], period: 3, group: 18},
                    
                    // Period 4
                    {atomicNumber: 19, symbol: 'K', name: 'Potassium', atomicMass: 39.10, category: 'alkali-metal', electronConfig: '[Ar] 4s1', shells: [2, 8, 8, 1], period: 4, group: 1},
                    {atomicNumber: 20, symbol: 'Ca', name: 'Calcium', atomicMass: 40.08, category: 'alkaline-earth', electronConfig: '[Ar] 4s2', shells: [2, 8, 8, 2], period: 4, group: 2},
                    {atomicNumber: 21, symbol: 'Sc', name: 'Scandium', atomicMass: 44.96, category: 'transition-metal', electronConfig: '[Ar] 3d1 4s2', shells: [2, 8, 9, 2], period: 4, group: 3},
                    {atomicNumber: 22, symbol: 'Ti', name: 'Titanium', atomicMass: 47.87, category: 'transition-metal', electronConfig: '[Ar] 3d2 4s2', shells: [2, 8, 10, 2], period: 4, group: 4},
                    {atomicNumber: 23, symbol: 'V', name: 'Vanadium', atomicMass: 50.94, category: 'transition-metal', electronConfig: '[Ar] 3d3 4s2', shells: [2, 8, 11, 2], period: 4, group: 5},
                    {atomicNumber: 24, symbol: 'Cr', name: 'Chromium', atomicMass: 52.00, category: 'transition-metal', electronConfig: '[Ar] 3d5 4s1', shells: [2, 8, 13, 1], period: 4, group: 6},
                    {atomicNumber: 25, symbol: 'Mn', name: 'Manganese', atomicMass: 54.94, category: 'transition-metal', electronConfig: '[Ar] 3d5 4s2', shells: [2, 8, 13, 2], period: 4, group: 7},
                    {atomicNumber: 26, symbol: 'Fe', name: 'Iron', atomicMass: 55.85, category: 'transition-metal', electronConfig: '[Ar] 3d6 4s2', shells: [2, 8, 14, 2], period: 4, group: 8},
                    {atomicNumber: 27, symbol: 'Co', name: 'Cobalt', atomicMass: 58.93, category: 'transition-metal', electronConfig: '[Ar] 3d7 4s2', shells: [2, 8, 15, 2], period: 4, group: 9},
                    {atomicNumber: 28, symbol: 'Ni', name: 'Nickel', atomicMass: 58.69, category: 'transition-metal', electronConfig: '[Ar] 3d8 4s2', shells: [2, 8, 16, 2], period: 4, group: 10},
                    {atomicNumber: 29, symbol: 'Cu', name: 'Copper', atomicMass: 63.55, category: 'transition-metal', electronConfig: '[Ar] 3d10 4s1', shells: [2, 8, 18, 1], period: 4, group: 11},
                    {atomicNumber: 30, symbol: 'Zn', name: 'Zinc', atomicMass: 65.38, category: 'transition-metal', electronConfig: '[Ar] 3d10 4s2', shells: [2, 8, 18, 2], period: 4, group: 12},
                    {atomicNumber: 31, symbol: 'Ga', name: 'Gallium', atomicMass: 69.72, category: 'post-transition', electronConfig: '[Ar] 3d10 4s2 4p1', shells: [2, 8, 18, 3], period: 4, group: 13},
                    {atomicNumber: 32, symbol: 'Ge', name: 'Germanium', atomicMass: 72.63, category: 'metalloid', electronConfig: '[Ar] 3d10 4s2 4p2', shells: [2, 8, 18, 4], period: 4, group: 14},
                    {atomicNumber: 33, symbol: 'As', name: 'Arsenic', atomicMass: 74.92, category: 'metalloid', electronConfig: '[Ar] 3d10 4s2 4p3', shells: [2, 8, 18, 5], period: 4, group: 15},
                    {atomicNumber: 34, symbol: 'Se', name: 'Selenium', atomicMass: 78.96, category: 'nonmetal', electronConfig: '[Ar] 3d10 4s2 4p4', shells: [2, 8, 18, 6], period: 4, group: 16},
                    {atomicNumber: 35, symbol: 'Br', name: 'Bromine', atomicMass: 79.90, category: 'halogen', electronConfig: '[Ar] 3d10 4s2 4p5', shells: [2, 8, 18, 7], period: 4, group: 17},
                    {atomicNumber: 36, symbol: 'Kr', name: 'Krypton', atomicMass: 83.80, category: 'noble-gas', electronConfig: '[Ar] 3d10 4s2 4p6', shells: [2, 8, 18, 8], period: 4, group: 18},
                    
                    // Period 5
                    {atomicNumber: 37, symbol: 'Rb', name: 'Rubidium', atomicMass: 85.47, category: 'alkali-metal', electronConfig: '[Kr] 5s1', shells: [2, 8, 18, 8, 1], period: 5, group: 1},
                    {atomicNumber: 38, symbol: 'Sr', name: 'Strontium', atomicMass: 87.62, category: 'alkaline-earth', electronConfig: '[Kr] 5s2', shells: [2, 8, 18, 8, 2], period: 5, group: 2},
                    {atomicNumber: 39, symbol: 'Y', name: 'Yttrium', atomicMass: 88.91, category: 'transition-metal', electronConfig: '[Kr] 4d1 5s2', shells: [2, 8, 18, 18, 1], period: 5, group: 3},
                    {atomicNumber: 40, symbol: 'Zr', name: 'Zirconium', atomicMass: 91.22, category: 'transition-metal', electronConfig: '[Kr] 4d2 5s2', shells: [2, 8, 18, 18, 2], period: 5, group: 4},
                    {atomicNumber: 41, symbol: 'Nb', name: 'Niobium', atomicMass: 92.91, category: 'transition-metal', electronConfig: '[Kr] 4d4 5s1', shells: [2, 8, 18, 18, 1], period: 5, group: 5},
                    {atomicNumber: 42, symbol: 'Mo', name: 'Molybdenum', atomicMass: 95.95, category: 'transition-metal', electronConfig: '[Kr] 4d5 5s1', shells: [2, 8, 18, 18, 1], period: 5, group: 6},
                    {atomicNumber: 43, symbol: 'Tc', name: 'Technetium', atomicMass: 98.00, category: 'transition-metal', electronConfig: '[Kr] 4d5 5s2', shells: [2, 8, 18, 18, 2], period: 5, group: 7},
                    {atomicNumber: 44, symbol: 'Ru', name: 'Ruthenium', atomicMass: 101.07, category: 'transition-metal', electronConfig: '[Kr] 4d7 5s1', shells: [2, 8, 18, 18, 1], period: 5, group: 8},
                    {atomicNumber: 45, symbol: 'Rh', name: 'Rhodium', atomicMass: 102.91, category: 'transition-metal', electronConfig: '[Kr] 4d8 5s1', shells: [2, 8, 18, 18, 1], period: 5, group: 9},
                    {atomicNumber: 46, symbol: 'Pd', name: 'Palladium', atomicMass: 106.42, category: 'transition-metal', electronConfig: '[Kr] 4d10', shells: [2, 8, 18, 18, 0], period: 5, group: 10},
                    {atomicNumber: 47, symbol: 'Ag', name: 'Silver', atomicMass: 107.87, category: 'transition-metal', electronConfig: '[Kr] 4d10 5s1', shells: [2, 8, 18, 18, 1], period: 5, group: 11},
                    {atomicNumber: 48, symbol: 'Cd', name: 'Cadmium', atomicMass: 112.41, category: 'transition-metal', electronConfig: '[Kr] 4d10 5s2', shells: [2, 8, 18, 18, 2], period: 5, group: 12},
                    {atomicNumber: 49, symbol: 'In', name: 'Indium', atomicMass: 114.82, category: 'post-transition', electronConfig: '[Kr] 4d10 5s2 5p1', shells: [2, 8, 18, 18, 3], period: 5, group: 13},
                    {atomicNumber: 50, symbol: 'Sn', name: 'Tin', atomicMass: 118.71, category: 'post-transition', electronConfig: '[Kr] 4d10 5s2 5p2', shells: [2, 8, 18, 18, 4], period: 5, group: 14},
                    {atomicNumber: 51, symbol: 'Sb', name: 'Antimony', atomicMass: 121.76, category: 'metalloid', electronConfig: '[Kr] 4d10 5s2 5p3', shells: [2, 8, 18, 18, 5], period: 5, group: 15},
                    {atomicNumber: 52, symbol: 'Te', name: 'Tellurium', atomicMass: 127.60, category: 'metalloid', electronConfig: '[Kr] 4d10 5s2 5p4', shells: [2, 8, 18, 18, 6], period: 5, group: 16},
                    {atomicNumber: 53, symbol: 'I', name: 'Iodine', atomicMass: 126.90, category: 'halogen', electronConfig: '[Kr] 4d10 5s2 5p5', shells: [2, 8, 18, 18, 7], period: 5, group: 17},
                    {atomicNumber: 54, symbol: 'Xe', name: 'Xenon', atomicMass: 131.29, category: 'noble-gas', electronConfig: '[Kr] 4d10 5s2 5p6', shells: [2, 8, 18, 18, 8], period: 5, group: 18},
                    
                    // Period 6
                    {atomicNumber: 55, symbol: 'Cs', name: 'Cesium', atomicMass: 132.91, category: 'alkali-metal', electronConfig: '[Xe] 6s1', shells: [2, 8, 18, 18, 8, 1], period: 6, group: 1},
                    {atomicNumber: 56, symbol: 'Ba', name: 'Barium', atomicMass: 137.33, category: 'alkaline-earth', electronConfig: '[Xe] 6s2', shells: [2, 8, 18, 18, 8, 2], period: 6, group: 2},
                    {atomicNumber: 57, symbol: 'La', name: 'Lanthanum', atomicMass: 138.91, category: 'lanthanide', electronConfig: '[Xe] 5d1 6s2', shells: [2, 8, 18, 18, 9, 2], period: 6, group: 3},
                    {atomicNumber: 58, symbol: 'Ce', name: 'Cerium', atomicMass: 140.12, category: 'lanthanide', electronConfig: '[Xe] 4f1 5d1 6s2', shells: [2, 8, 18, 19, 9, 2], period: 6, group: 3},
                    {atomicNumber: 59, symbol: 'Pr', name: 'Praseodymium', atomicMass: 140.91, category: 'lanthanide', electronConfig: '[Xe] 4f3 6s2', shells: [2, 8, 18, 21, 9, 2], period: 6, group: 3},
                    {atomicNumber: 60, symbol: 'Nd', name: 'Neodymium', atomicMass: 144.24, category: 'lanthanide', electronConfig: '[Xe] 4f4 6s2', shells: [2, 8, 18, 22, 9, 2], period: 6, group: 3},
                    {atomicNumber: 61, symbol: 'Pm', name: 'Promethium', atomicMass: 145.00, category: 'lanthanide', electronConfig: '[Xe] 4f5 6s2', shells: [2, 8, 18, 23, 9, 2], period: 6, group: 3},
                    {atomicNumber: 62, symbol: 'Sm', name: 'Samarium', atomicMass: 150.36, category: 'lanthanide', electronConfig: '[Xe] 4f6 6s2', shells: [2, 8, 18, 24, 9, 2], period: 6, group: 3},
                    {atomicNumber: 63, symbol: 'Eu', name: 'Europium', atomicMass: 151.96, category: 'lanthanide', electronConfig: '[Xe] 4f7 6s2', shells: [2, 8, 18, 25, 9, 2], period: 6, group: 3},
                    {atomicNumber: 64, symbol: 'Gd', name: 'Gadolinium', atomicMass: 157.25, category: 'lanthanide', electronConfig: '[Xe] 4f7 5d1 6s2', shells: [2, 8, 18, 25, 10, 2], period: 6, group: 3},
                    {atomicNumber: 65, symbol: 'Tb', name: 'Terbium', atomicMass: 158.93, category: 'lanthanide', electronConfig: '[Xe] 4f9 6s2', shells: [2, 8, 18, 27, 9, 2], period: 6, group: 3},
                    {atomicNumber: 66, symbol: 'Dy', name: 'Dysprosium', atomicMass: 162.50, category: 'lanthanide', electronConfig: '[Xe] 4f10 6s2', shells: [2, 8, 18, 28, 9, 2], period: 6, group: 3},
                    {atomicNumber: 67, symbol: 'Ho', name: 'Holmium', atomicMass: 164.93, category: 'lanthanide', electronConfig: '[Xe] 4f11 6s2', shells: [2, 8, 18, 29, 9, 2], period: 6, group: 3},
                    {atomicNumber: 68, symbol: 'Er', name: 'Erbium', atomicMass: 167.26, category: 'lanthanide', electronConfig: '[Xe] 4f12 6s2', shells: [2, 8, 18, 30, 9, 2], period: 6, group: 3},
                    {atomicNumber: 69, symbol: 'Tm', name: 'Thulium', atomicMass: 168.93, category: 'lanthanide', electronConfig: '[Xe] 4f13 6s2', shells: [2, 8, 18, 31, 9, 2], period: 6, group: 3},
                    {atomicNumber: 70, symbol: 'Yb', name: 'Ytterbium', atomicMass: 173.05, category: 'lanthanide', electronConfig: '[Xe] 4f14 6s2', shells: [2, 8, 18, 32, 9, 2], period: 6, group: 3},
                    {atomicNumber: 71, symbol: 'Lu', name: 'Lutetium', atomicMass: 174.97, category: 'lanthanide', electronConfig: '[Xe] 4f14 5d1 6s2', shells: [2, 8, 18, 32, 10, 2], period: 6, group: 3},
                    {atomicNumber: 72, symbol: 'Hf', name: 'Hafnium', atomicMass: 178.49, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d2 6s2', shells: [2, 8, 18, 32, 10, 2], period: 6, group: 4},
                    {atomicNumber: 73, symbol: 'Ta', name: 'Tantalum', atomicMass: 180.95, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d3 6s2', shells: [2, 8, 18, 32, 11, 2], period: 6, group: 5},
                    {atomicNumber: 74, symbol: 'W', name: 'Tungsten', atomicMass: 183.84, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d4 6s2', shells: [2, 8, 18, 32, 12, 2], period: 6, group: 6},
                    {atomicNumber: 75, symbol: 'Re', name: 'Rhenium', atomicMass: 186.21, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d5 6s2', shells: [2, 8, 18, 32, 13, 2], period: 6, group: 7},
                    {atomicNumber: 76, symbol: 'Os', name: 'Osmium', atomicMass: 190.23, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d6 6s2', shells: [2, 8, 18, 32, 14, 2], period: 6, group: 8},
                    {atomicNumber: 77, symbol: 'Ir', name: 'Iridium', atomicMass: 192.22, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d7 6s2', shells: [2, 8, 18, 32, 15, 2], period: 6, group: 9},
                    {atomicNumber: 78, symbol: 'Pt', name: 'Platinum', atomicMass: 195.08, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d9 6s1', shells: [2, 8, 18, 32, 16, 1], period: 6, group: 10},
                    {atomicNumber: 79, symbol: 'Au', name: 'Gold', atomicMass: 196.97, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d10 6s1', shells: [2, 8, 18, 32, 18, 1], period: 6, group: 11},
                    {atomicNumber: 80, symbol: 'Hg', name: 'Mercury', atomicMass: 200.59, category: 'transition-metal', electronConfig: '[Xe] 4f14 5d10 6s2', shells: [2, 8, 18, 32, 18, 2], period: 6, group: 12},
                    {atomicNumber: 81, symbol: 'Tl', name: 'Thallium', atomicMass: 204.38, category: 'post-transition', electronConfig: '[Xe] 4f14 5d10 6s2 6p1', shells: [2, 8, 18, 32, 18, 3], period: 6, group: 13},
                    {atomicNumber: 82, symbol: 'Pb', name: 'Lead', atomicMass: 207.2, category: 'post-transition', electronConfig: '[Xe] 4f14 5d10 6s2 6p2', shells: [2, 8, 18, 32, 18, 4], period: 6, group: 14},
                    {atomicNumber: 83, symbol: 'Bi', name: 'Bismuth', atomicMass: 208.98, category: 'post-transition', electronConfig: '[Xe] 4f14 5d10 6s2 6p3', shells: [2, 8, 18, 32, 18, 5], period: 6, group: 15},
                    {atomicNumber: 84, symbol: 'Po', name: 'Polonium', atomicMass: 209.00, category: 'post-transition', electronConfig: '[Xe] 4f14 5d10 6s2 6p4', shells: [2, 8, 18, 32, 18, 6], period: 6, group: 16},
                    {atomicNumber: 85, symbol: 'At', name: 'Astatine', atomicMass: 210.00, category: 'halogen', electronConfig: '[Xe] 4f14 5d10 6s2 6p5', shells: [2, 8, 18, 32, 18, 7], period: 6, group: 17},
                    {atomicNumber: 86, symbol: 'Rn', name: 'Radon', atomicMass: 222.00, category: 'noble-gas', electronConfig: '[Xe] 4f14 5d10 6s2 6p6', shells: [2, 8, 18, 32, 18, 8], period: 6, group: 18},
                    
                    // Period 7
                    {atomicNumber: 87, symbol: 'Fr', name: 'Francium', atomicMass: 223.00, category: 'alkali-metal', electronConfig: '[Rn] 7s1', shells: [2, 8, 18, 32, 18, 8, 1], period: 7, group: 1},
                    {atomicNumber: 88, symbol: 'Ra', name: 'Radium', atomicMass: 226.00, category: 'alkaline-earth', electronConfig: '[Rn] 7s2', shells: [2, 8, 18, 32, 18, 8, 2], period: 7, group: 2},
                    {atomicNumber: 89, symbol: 'Ac', name: 'Actinium', atomicMass: 227.00, category: 'actinide', electronConfig: '[Rn] 6d1 7s2', shells: [2, 8, 18, 32, 18, 9, 2], period: 7, group: 3},
                    {atomicNumber: 90, symbol: 'Th', name: 'Thorium', atomicMass: 232.04, category: 'actinide', electronConfig: '[Rn] 6d2 7s2', shells: [2, 8, 18, 32, 18, 10, 2], period: 7, group: 3},
                    {atomicNumber: 91, symbol: 'Pa', name: 'Protactinium', atomicMass: 231.04, category: 'actinide', electronConfig: '[Rn] 5f2 6d1 7s2', shells: [2, 8, 18, 32, 20, 10, 2], period: 7, group: 3},
                    {atomicNumber: 92, symbol: 'U', name: 'Uranium', atomicMass: 238.03, category: 'actinide', electronConfig: '[Rn] 5f3 6d1 7s2', shells: [2, 8, 18, 32, 21, 10, 2], period: 7, group: 3},
                    {atomicNumber: 93, symbol: 'Np', name: 'Neptunium', atomicMass: 237.00, category: 'actinide', electronConfig: '[Rn] 5f4 6d1 7s2', shells: [2, 8, 18, 32, 22, 10, 2], period: 7, group: 3},
                    {atomicNumber: 94, symbol: 'Pu', name: 'Plutonium', atomicMass: 244.00, category: 'actinide', electronConfig: '[Rn] 5f6 7s2', shells: [2, 8, 18, 32, 24, 9, 2], period: 7, group: 3},
                    {atomicNumber: 95, symbol: 'Am', name: 'Americium', atomicMass: 243.00, category: 'actinide', electronConfig: '[Rn] 5f7 7s2', shells: [2, 8, 18, 32, 25, 9, 2], period: 7, group: 3},
                    {atomicNumber: 96, symbol: 'Cm', name: 'Curium', atomicMass: 247.00, category: 'actinide', electronConfig: '[Rn] 5f7 6d1 7s2', shells: [2, 8, 18, 32, 25, 10, 2], period: 7, group: 3},
                    {atomicNumber: 97, symbol: 'Bk', name: 'Berkelium', atomicMass: 247.00, category: 'actinide', electronConfig: '[Rn] 5f9 7s2', shells: [2, 8, 18, 32, 27, 9, 2], period: 7, group: 3},
                    {atomicNumber: 98, symbol: 'Cf', name: 'Californium', atomicMass: 251.00, category: 'actinide', electronConfig: '[Rn] 5f10 7s2', shells: [2, 8, 18, 32, 28, 9, 2], period: 7, group: 3},
                    {atomicNumber: 99, symbol: 'Es', name: 'Einsteinium', atomicMass: 252.00, category: 'actinide', electronConfig: '[Rn] 5f11 7s2', shells: [2, 8, 18, 32, 29, 9, 2], period: 7, group: 3},
                    {atomicNumber: 100, symbol: 'Fm', name: 'Fermium', atomicMass: 257.00, category: 'actinide', electronConfig: '[Rn] 5f12 7s2', shells: [2, 8, 18, 32, 30, 9, 2], period: 7, group: 3},
                    {atomicNumber: 101, symbol: 'Md', name: 'Mendelevium', atomicMass: 258.00, category: 'actinide', electronConfig: '[Rn] 5f13 7s2', shells: [2, 8, 18, 32, 31, 9, 2], period: 7, group: 3},
                    {atomicNumber: 102, symbol: 'No', name: 'Nobelium', atomicMass: 259.00, category: 'actinide', electronConfig: '[Rn] 5f14 7s2', shells: [2, 8, 18, 32, 32, 9, 2], period: 7, group: 3},
                    {atomicNumber: 103, symbol: 'Lr', name: 'Lawrencium', atomicMass: 262.00, category: 'actinide', electronConfig: '[Rn] 5f14 7s2 7p1', shells: [2, 8, 18, 32, 32, 9, 3], period: 7, group: 3},
                    {atomicNumber: 104, symbol: 'Rf', name: 'Rutherfordium', atomicMass: 267.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d2 7s2', shells: [2, 8, 18, 32, 32, 10, 2], period: 7, group: 4},
                    {atomicNumber: 105, symbol: 'Db', name: 'Dubnium', atomicMass: 268.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d3 7s2', shells: [2, 8, 18, 32, 32, 11, 2], period: 7, group: 5},
                    {atomicNumber: 106, symbol: 'Sg', name: 'Seaborgium', atomicMass: 271.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d4 7s2', shells: [2, 8, 18, 32, 32, 12, 2], period: 7, group: 6},
                    {atomicNumber: 107, symbol: 'Bh', name: 'Bohrium', atomicMass: 272.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d5 7s2', shells: [2, 8, 18, 32, 32, 13, 2], period: 7, group: 7},
                    {atomicNumber: 108, symbol: 'Hs', name: 'Hassium', atomicMass: 277.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d6 7s2', shells: [2, 8, 18, 32, 32, 14, 2], period: 7, group: 8},
                    {atomicNumber: 109, symbol: 'Mt', name: 'Meitnerium', atomicMass: 276.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d7 7s2', shells: [2, 8, 18, 32, 32, 15, 2], period: 7, group: 9},
                    {atomicNumber: 110, symbol: 'Ds', name: 'Darmstadtium', atomicMass: 281.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d8 7s2', shells: [2, 8, 18, 32, 32, 16, 2], period: 7, group: 10},
                    {atomicNumber: 111, symbol: 'Rg', name: 'Roentgenium', atomicMass: 280.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d9 7s2', shells: [2, 8, 18, 32, 32, 17, 2], period: 7, group: 11},
                    {atomicNumber: 112, symbol: 'Cn', name: 'Copernicium', atomicMass: 285.00, category: 'transition-metal', electronConfig: '[Rn] 5f14 6d10 7s2', shells: [2, 8, 18, 32, 32, 18, 2], period: 7, group: 12},
                    {atomicNumber: 113, symbol: 'Nh', name: 'Nihonium', atomicMass: 284.00, category: 'post-transition', electronConfig: '[Rn] 5f14 6d10 7s2 7p1', shells: [2, 8, 18, 32, 32, 18, 3], period: 7, group: 13},
                    {atomicNumber: 114, symbol: 'Fl', name: 'Flerovium', atomicMass: 289.00, category: 'post-transition', electronConfig: '[Rn] 5f14 6d10 7s2 7p2', shells: [2, 8, 18, 32, 32, 18, 4], period: 7, group: 14},
                    {atomicNumber: 115, symbol: 'Mc', name: 'Moscovium', atomicMass: 288.00, category: 'post-transition', electronConfig: '[Rn] 5f14 6d10 7s2 7p3', shells: [2, 8, 18, 32, 32, 18, 5], period: 7, group: 15},
                    {atomicNumber: 116, symbol: 'Lv', name: 'Livermorium', atomicMass: 293.00, category: 'post-transition', electronConfig: '[Rn] 5f14 6d10 7s2 7p4', shells: [2, 8, 18, 32, 32, 18, 6], period: 7, group: 16},
                    {atomicNumber: 117, symbol: 'Ts', name: 'Tennessine', atomicMass: 294.00, category: 'halogen', electronConfig: '[Rn] 5f14 6d10 7s2 7p5', shells: [2, 8, 18, 32, 32, 18, 7], period: 7, group: 17},
                    {atomicNumber: 118, symbol: 'Og', name: 'Oganesson', atomicMass: 294.00, category: 'noble-gas', electronConfig: '[Rn] 5f14 6d10 7s2 7p6', shells: [2, 8, 18, 32, 32, 18, 8], period: 7, group: 18}
                ];
                
                // CPK Color Scheme (118 elements)
                var cpkColors = {
                    'H': '#FFFFFF', 'He': '#D9FFFF', 'Li': '#CC80FF', 'Be': '#C2FF00', 'B': '#B5FF5F',
                    'C': '#909090', 'N': '#3050F8', 'O': '#FF0D0D', 'F': '#90E050', 'Ne': '#B3E3F5',
                    'Na': '#AB5CF2', 'Mg': '#8AFF00', 'Al': '#BFA6A6', 'Si': '#F0C8A0', 'P': '#FF8000',
                    'S': '#FFFF30', 'Cl': '#1FF01F', 'Ar': '#80D1E3', 'K': '#8F40D4', 'Ca': '#3DFF00',
                    'Sc': '#E6E6E6', 'Ti': '#BFC2C7', 'V': '#A6A6AB', 'Cr': '#8A99C7', 'Mn': '#9C7AC7',
                    'Fe': '#E06633', 'Co': '#F090A0', 'Ni': '#50D050', 'Cu': '#C88033', 'Zn': '#7D80B0',
                    'Ga': '#C28F8F', 'Ge': '#668F8F', 'As': '#BD80E3', 'Se': '#FFA100', 'Br': '#A62929',
                    'Kr': '#5CB8D1', 'Rb': '#702EB0', 'Sr': '#00FF00', 'Y': '#94FFFF', 'Zr': '#94E0E0',
                    'Nb': '#73C2C9', 'Mo': '#54B5B5', 'Tc': '#3B9E9E', 'Ru': '#248F8F', 'Rh': '#0A7D8C',
                    'Pd': '#006985', 'Ag': '#C0C0C0', 'Cd': '#FFD98F', 'In': '#A67573', 'Sn': '#668080',
                    'Sb': '#9E63B5', 'Te': '#D47A00', 'I': '#940094', 'Xe': '#429EB0', 'Cs': '#57178F',
                    'Ba': '#00C900', 'La': '#70D4FF', 'Ce': '#FFFFC7', 'Pr': '#D9FFC7', 'Nd': '#C7FFC7',
                    'Pm': '#A3FFC7', 'Sm': '#8FFFC7', 'Eu': '#61FFC7', 'Gd': '#45FFC7', 'Tb': '#30FFC7',
                    'Dy': '#1FFFC7', 'Ho': '#00FF9C', 'Er': '#00E675', 'Tm': '#00D452', 'Yb': '#00BF38',
                    'Lu': '#00AB24', 'Hf': '#4DC2FF', 'Ta': '#4DA6FF', 'W': '#2194D6', 'Re': '#267DAB',
                    'Os': '#266696', 'Ir': '#175487', 'Pt': '#D0D0E0', 'Au': '#FFD123', 'Hg': '#B8B8D0',
                    'Tl': '#A6544D', 'Pb': '#575961', 'Bi': '#9E4FB5', 'Po': '#AB5C00', 'At': '#754545',
                    'Rn': '#428296', 'Fr': '#420066', 'Ra': '#007D00', 'Ac': '#70ABFA', 'Th': '#00BAFF',
                    'Pa': '#00A1FF', 'U': '#008FFF', 'Np': '#0080FF', 'Pu': '#006BFF', 'Am': '#545CF2',
                    'Cm': '#785CE3', 'Bk': '#8A4FE3', 'Cf': '#A136D4', 'Es': '#B31FD4', 'Fm': '#B31FBA',
                    'Md': '#B30DA6', 'No': '#B30D87', 'Lr': '#C70066', 'Rf': '#CC0059', 'Db': '#D1004F',
                    'Sg': '#D90045', 'Bh': '#E00038', 'Hs': '#E6002E', 'Mt': '#EB0026', 'Ds': '#ED1B24',
                    'Rg': '#EF1E20', 'Cn': '#F01921', 'Fl': '#F1181F', 'Lv': '#F1181D', 'Ts': '#F1171B',
                    'Og': '#F11719'
                };
                
                // Atomic Radii (118 elements)
                var atomicRadii = {
                    'H': 0.31, 'He': 0.28, 'Li': 1.28, 'Be': 0.96, 'B': 0.84, 'C': 0.76,
                    'N': 0.71, 'O': 0.66, 'F': 0.57, 'Ne': 0.54, 'Na': 1.66, 'Mg': 1.41,
                    'Al': 1.21, 'Si': 1.11, 'P': 1.07, 'S': 1.05, 'Cl': 1.02, 'Ar': 1.06,
                    'K': 2.03, 'Ca': 1.76, 'Sc': 1.70, 'Ti': 1.60, 'V': 1.53, 'Cr': 1.39,
                    'Mn': 1.50, 'Fe': 1.42, 'Co': 1.38, 'Ni': 1.24, 'Cu': 1.32, 'Zn': 1.22,
                    'Ga': 1.22, 'Ge': 1.20, 'As': 1.19, 'Se': 1.16, 'Br': 1.14, 'Kr': 1.17,
                    'Rb': 2.20, 'Sr': 1.95, 'Y': 1.90, 'Zr': 1.75, 'Nb': 1.64, 'Mo': 1.54,
                    'Tc': 1.47, 'Ru': 1.46, 'Rh': 1.42, 'Pd': 1.39, 'Ag': 1.45, 'Cd': 1.44,
                    'In': 1.42, 'Sn': 1.39, 'Sb': 1.39, 'Te': 1.38, 'I': 1.39, 'Xe': 1.40,
                    'Cs': 2.44, 'Ba': 2.15, 'La': 2.07, 'Ce': 2.04, 'Pr': 2.03, 'Nd': 2.01,
                    'Pm': 1.99, 'Sm': 1.98, 'Eu': 1.98, 'Gd': 1.96, 'Tb': 1.94, 'Dy': 1.92,
                    'Ho': 1.92, 'Er': 1.89, 'Tm': 1.90, 'Yb': 1.87, 'Lu': 1.87, 'Hf': 1.75,
                    'Ta': 1.70, 'W': 1.62, 'Re': 1.51, 'Os': 1.44, 'Ir': 1.41, 'Pt': 1.36,
                    'Au': 1.36, 'Hg': 1.32, 'Tl': 1.45, 'Pb': 1.46, 'Bi': 1.48, 'Po': 1.46,
                    'At': 1.48, 'Rn': 1.47, 'Fr': 2.60, 'Ra': 2.21, 'Ac': 2.15, 'Th': 2.06,
                    'Pa': 2.00, 'U': 1.96, 'Np': 1.90, 'Pu': 1.84, 'Am': 1.80, 'Cm': 1.69,
                    'Bk': 1.68, 'Cf': 1.68, 'Es': 1.65, 'Fm': 1.67, 'Md': 1.73, 'No': 1.76,
                    'Lr': 1.61, 'Rf': 1.57, 'Db': 1.49, 'Sg': 1.43, 'Bh': 1.41, 'Hs': 1.34,
                    'Mt': 1.29, 'Ds': 1.28, 'Rg': 1.21, 'Cn': 1.22, 'Fl': 1.23, 'Lv': 1.24,
                    'Ts': 1.25, 'Og': 1.26
                };
                
                // ===== MOLECULE TEMPLATES =====
                var moleculeTemplates = {
                    'H2O': {
                        name: 'Water',
                        formula: 'H2O',
                        geometry: 'bent',
                        bondAngle: 104.5,
                        atoms: [
                            {element: 'O', position: [0, 0, 0], id: 'O1'},
                            {element: 'H', position: [0.957, 0, 0], id: 'H1'},
                            {element: 'H', position: [-0.239, 0.927, 0], id: 'H2'}
                        ],
                        bonds: [
                            {from: 'O1', to: 'H1', type: 'single'},
                            {from: 'O1', to: 'H2', type: 'single'}
                        ]
                    },
                    'CO2': {
                        name: 'Carbon Dioxide',
                        formula: 'CO2',
                        geometry: 'linear',
                        bondAngle: 180,
                        atoms: [
                            {element: 'C', position: [0, 0, 0], id: 'C1'},
                            {element: 'O', position: [1.16, 0, 0], id: 'O1'},
                            {element: 'O', position: [-1.16, 0, 0], id: 'O2'}
                        ],
                        bonds: [
                            {from: 'C1', to: 'O1', type: 'double'},
                            {from: 'C1', to: 'O2', type: 'double'}
                        ]
                    },
                    'CH4': {
                        name: 'Methane',
                        formula: 'CH4',
                        geometry: 'tetrahedral',
                        bondAngle: 109.5,
                        atoms: [
                            {element: 'C', position: [0, 0, 0], id: 'C1'},
                            {element: 'H', position: [0.629, 0.629, 0.629], id: 'H1'},
                            {element: 'H', position: [-0.629, -0.629, 0.629], id: 'H2'},
                            {element: 'H', position: [-0.629, 0.629, -0.629], id: 'H3'},
                            {element: 'H', position: [0.629, -0.629, -0.629], id: 'H4'}
                        ],
                        bonds: [
                            {from: 'C1', to: 'H1', type: 'single'},
                            {from: 'C1', to: 'H2', type: 'single'},
                            {from: 'C1', to: 'H3', type: 'single'},
                            {from: 'C1', to: 'H4', type: 'single'}
                        ]
                    },
                    'NH3': {
                        name: 'Ammonia',
                        formula: 'NH3',
                        geometry: 'trigonal_pyramidal',
                        bondAngle: 107.8,
                        atoms: [
                            {element: 'N', position: [0, 0, 0], id: 'N1'},
                            {element: 'H', position: [0.473, 0.819, 0.333], id: 'H1'},
                            {element: 'H', position: [0.473, -0.819, 0.333], id: 'H2'},
                            {element: 'H', position: [-0.946, 0, 0.333], id: 'H3'}
                        ],
                        bonds: [
                            {from: 'N1', to: 'H1', type: 'single'},
                            {from: 'N1', to: 'H2', type: 'single'},
                            {from: 'N1', to: 'H3', type: 'single'}
                        ]
                    },
                    'O2': {
                        name: 'Oxygen',
                        formula: 'O2',
                        geometry: 'diatomic',
                        bondAngle: 180,
                        atoms: [
                            {element: 'O', position: [-0.604, 0, 0], id: 'O1'},
                            {element: 'O', position: [0.604, 0, 0], id: 'O2'}
                        ],
                        bonds: [
                            {from: 'O1', to: 'O2', type: 'double'}
                        ]
                    },
                    'N2': {
                        name: 'Nitrogen',
                        formula: 'N2',
                        geometry: 'diatomic',
                        bondAngle: 180,
                        atoms: [
                            {element: 'N', position: [-0.55, 0, 0], id: 'N1'},
                            {element: 'N', position: [0.55, 0, 0], id: 'N2'}
                        ],
                        bonds: [
                            {from: 'N1', to: 'N2', type: 'triple'}
                        ]
                    }
                };
                
                // ===== FORMULA PARSER =====
                function parseFormula(formula) {
                    try {
                        // Parse the formula to get atom counts
                        var atomCounts = parseAtomCounts(formula);
                        if (!atomCounts || Object.keys(atomCounts).length === 0) {
                            return null;
                        }

                        // Generate molecular structure
                        return generateMoleculeStructure(formula, atomCounts);
                    } catch (error) {
                        console.error('Error parsing formula:', formula, error);
                        return null;
                    }
                }

                function parseAtomCounts(formula) {
                    var cleanFormula = formula.replace(/\s+/g, '').toUpperCase();
                    var regex = /([A-Z][a-z]?)(\d*)/g;
                    var matches;
                    var atomCounts = {};

                    while ((matches = regex.exec(cleanFormula)) !== null) {
                        var element = matches[1];
                        var count = parseInt(matches[2]) || 1;

                        // Validate element
                        if (!isValidElement(element)) {
                            return null;
                        }

                        atomCounts[element] = (atomCounts[element] || 0) + count;
                    }

                    return Object.keys(atomCounts).length > 0 ? atomCounts : null;
                }

                function isValidElement(symbol) {
                    return elements.find(function(element) {
                        return element.symbol === symbol;
                    }) !== null;
                }

                function generateMoleculeStructure(formula, atomCounts) {
                    var atoms = [];
                    var bonds = [];
                    var atomIdCounter = 1;

                    // Generate atoms
                    Object.keys(atomCounts).forEach(function(element) {
                        var count = atomCounts[element];
                        for (var i = 0; i < count; i++) {
                            atoms.push({
                                element: element,
                                position: generateAtomPosition(element, i, count),
                                id: element + atomIdCounter++
                            });
                        }
                    });

                    // Generate bonds based on simple rules
                    bonds = generateBonds(atoms);

                    return {
                        name: getMoleculeName(formula),
                        formula: formula,
                        geometry: determineGeometry(atomCounts),
                        atoms: atoms,
                        bonds: bonds
                    };
                }

                function generateAtomPosition(element, index, total) {
                    var radius = (atomicRadii[element] || 1.0) * 0.5;
                    var angle = (index / total) * 2 * Math.PI;
                    
                    // Simple circular arrangement for unknown molecules
                    var x = radius * 2 * Math.cos(angle);
                    var y = radius * 2 * Math.sin(angle);
                    var z = 0;

                    return [x, y, z];
                }

                function generateBonds(atoms) {
                    var bonds = [];
                    var maxBondDistance = 2.0; // Maximum distance for bond formation

                    for (var i = 0; i < atoms.length; i++) {
                        for (var j = i + 1; j < atoms.length; j++) {
                            var distance = calculateDistance(atoms[i].position, atoms[j].position);
                            
                            if (distance <= maxBondDistance) {
                                bonds.push({
                                    from: atoms[i].id,
                                    to: atoms[j].id,
                                    type: determineBondType(atoms[i].element, atoms[j].element)
                                });
                            }
                        }
                    }

                    return bonds;
                }

                function calculateDistance(pos1, pos2) {
                    var dx = pos1[0] - pos2[0];
                    var dy = pos1[1] - pos2[1];
                    var dz = pos1[2] - pos2[2];
                    return Math.sqrt(dx * dx + dy * dy + dz * dz);
                }

                function determineBondType(element1, element2) {
                    // Simplified bond type determination
                    if (element1 === element2) {
                        if (element1 === 'O') return 'double';
                        if (element1 === 'N') return 'triple';
                    }
                    return 'single';
                }

                function determineGeometry(atomCounts) {
                    var totalAtoms = Object.values(atomCounts).reduce(function(sum, count) {
                        return sum + count;
                    }, 0);

                    if (totalAtoms === 2) return 'diatomic';
                    if (totalAtoms === 3) return 'bent';
                    if (totalAtoms === 4) return 'tetrahedral';
                    if (totalAtoms === 5) return 'trigonal_bipyramidal';
                    if (totalAtoms === 6) return 'octahedral';
                    
                    return 'unknown';
                }

                function getMoleculeName(formula) {
                    var commonNames = {
                        'H2O': 'Water',
                        'CO2': 'Carbon Dioxide',
                        'CH4': 'Methane',
                        'NH3': 'Ammonia',
                        'O2': 'Oxygen',
                        'N2': 'Nitrogen',
                        'C6H6': 'Benzene',
                        'C2H5OH': 'Ethanol',
                        'CH3COOH': 'Acetic Acid',
                        'H2SO4': 'Sulfuric Acid',
                        'NaCl': 'Sodium Chloride',
                        'C12H22O11': 'Sucrose'
                    };

                    return commonNames[formula] || formula;
                }

                // ===== CONTROLLER METHODS =====
                vm.$onInit = function() {
                    initScene();
                    startAnimation();
                };
                
                vm.setMode = function(mode) {
                    vm.mode = mode;
                    clearScene();
                    vm.showInfo = false;
                    vm.currentMolecule = null;
                    vm.selectedElement = '';
                };
                
                vm.generateMolecule = function() {
                    if (!vm.formula.trim()) {
                        vm.showError('Please enter a chemical formula');
                        return;
                    }
                    vm.loadMolecule(vm.formula);
                };
                
                vm.loadMolecule = function(formula) {
                    vm.isLoading = true;
                    vm.hideMessages();
                    
                    $timeout(function() {
                        // First try predefined templates
                        var moleculeData = moleculeTemplates[formula];
                        if (moleculeData) {
                            // Store the current molecule and formula
                            vm.currentMolecule = moleculeData;
                            vm.formula = formula;
                            
                            renderMolecule(moleculeData);
                            vm.showMoleculeInfo(moleculeData);
                            vm.showSuccess('Molecule generated successfully!');
                        } else {
                            // Try to parse the formula dynamically
                            var parsedMolecule = parseFormula(formula);
                            if (parsedMolecule) {
                                vm.currentMolecule = parsedMolecule;
                                vm.formula = formula;
                                
                                renderMolecule(parsedMolecule);
                                vm.showMoleculeInfo(parsedMolecule);
                                vm.showSuccess('Molecule generated successfully!');
                            } else {
                                vm.showError('Invalid formula. Try: H2O, CO2, CH4, NH3, O2, N2');
                            }
                        }
                        vm.isLoading = false;
                    }, 500);
                };
                
                vm.selectElement = function(element) {
                    console.log('Selecting element:', element);
                    vm.isLoading = true;
                    
                    $timeout(function() {
                        console.log('Rendering atom for:', element.name);
                        renderAtom(element);
                        vm.showAtomInfo(element);
                        vm.isLoading = false;
                    }, 500);
                };
                
                vm.handleKeyPress = function(event) {
                    if (event.key === 'Enter') {
                        vm.generateMolecule();
                    }
                };
                
                // Removed display model and auto-rotation functionality
                
                vm.resetView = function() {
                    centerCamera();
                };
                
                vm.takeScreenshot = function() {
                    renderer.render(scene, camera);
                    var dataUrl = renderer.domElement.toDataURL('image/png');
                    
                    var link = document.createElement('a');
                    link.download = 'molecular_visualizer_' + Date.now() + '.png';
                    link.href = dataUrl;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
                
                vm.showError = function(message) {
                    vm.errorMessage = message;
                    vm.successMessage = '';
                    $timeout(function() { vm.hideMessages(); }, 5000);
                };
                
                vm.showSuccess = function(message) {
                    vm.successMessage = message;
                    vm.errorMessage = '';
                    $timeout(function() { vm.hideMessages(); }, 3000);
                };
                
                vm.hideMessages = function() {
                    vm.errorMessage = '';
                    vm.successMessage = '';
                };
                
                vm.showMoleculeInfo = function(molecule) {
                    vm.showInfo = true;
                    vm.infoTitle = molecule.name || 'Unknown Molecule';
                    vm.infoDetails = $sce.trustAsHtml(
                        '<p><strong>Formula:</strong> ' + (molecule.formula || 'Unknown') + '</p>' +
                        '<p><strong>Atoms:</strong> ' + (molecule.atoms ? molecule.atoms.length : 0) + '</p>' +
                        '<p><strong>Bonds:</strong> ' + (molecule.bonds ? molecule.bonds.length : 0) + '</p>' +
                        '<p><strong>Geometry:</strong> ' + (molecule.geometry || 'Unknown') + '</p>'
                    );
                };
                
                vm.showAtomInfo = function(element) {
                    vm.showInfo = true;
                    vm.infoTitle = element.name + ' (' + element.symbol + ')';
                    vm.infoDetails = $sce.trustAsHtml(
                        '<p><strong>Atomic Number:</strong> ' + element.atomicNumber + '</p>' +
                        '<p><strong>Atomic Mass:</strong> ' + element.atomicMass + '</p>' +
                        '<p><strong>Category:</strong> ' + element.category + '</p>' +
                        '<p><strong>Electron Config:</strong> ' + element.electronConfig + '</p>' +
                        '<p><strong>Shells:</strong> ' + element.shells.join(', ') + '</p>'
                    );
                };
                
                // ===== DROPDOWN METHODS =====
                vm.selectedElement = '';
                vm.allElements = elements;
                
                vm.onElementChange = function() {
                    if (vm.selectedElement) {
                        var elementData = vm.getSelectedElementData();
                        if (elementData) {
                            vm.selectElement(elementData);
                        } else {
                            // Clear the scene if no valid element selected
                            clearScene();
                            vm.showInfo = false;
                        }
                    } else {
                        // Clear the scene if no element selected
                        clearScene();
                        vm.showInfo = false;
                    }
                };
                
                vm.getSelectedElementData = function() {
                    var element = elements.find(function(element) {
                        return element.symbol === vm.selectedElement;
                    });
                    console.log('Selected element:', vm.selectedElement, 'Found:', element);
                    return element;
                };
                
                // Create periodic table grid (kept for compatibility)
                vm.periodicGrid = getPeriodicGrid();
                
                function getPeriodicGrid() {
                    var grid = [];
                    var maxPeriod = 4;
                    var maxGroup = 18;
                    
                    for (var i = 0; i < maxPeriod; i++) {
                        grid[i] = new Array(maxGroup).fill(null);
                    }
                    
                    elements.forEach(function(element) {
                        if (element.period <= maxPeriod && element.group <= maxGroup) {
                            grid[element.period - 1][element.group - 1] = element;
                        }
                    });
                    
                    return grid;
                }

                // ===== THREE.JS FUNCTIONS =====
                function initScene() {
                    var container = document.getElementById('viewerContainer');
                    
                    // Create scene
                    scene = new THREE.Scene();
                    scene.background = new THREE.Color(0x0a0a0a);
                    
                    // Create camera
                    var width = container.clientWidth;
                    var height = container.clientHeight;
                    camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                    camera.position.set(0, 0, 10);
                    
                    // Create renderer
                    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setSize(width, height);
                    renderer.setPixelRatio(window.devicePixelRatio);
                    renderer.shadowMap.enabled = true;
                    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                    container.appendChild(renderer.domElement);
                    
                    // Create controls
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.enableZoom = true;
                    controls.enablePan = true;
                    controls.minDistance = 3;
                    controls.maxDistance = 50;
                    
                    // Setup lighting
                    setupLighting();
                    
                    // Handle window resize
                    window.addEventListener('resize', onWindowResize);
                }

                function setupLighting() {
                    lights.forEach(function(light) { scene.remove(light); });
                    lights = [];
                    
                    var ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                    scene.add(ambientLight);
                    lights.push(ambientLight);
                    
                    var directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(5, 5, 5);
                    directionalLight.castShadow = true;
                    scene.add(directionalLight);
                    lights.push(directionalLight);
                    
                    var fillLight = new THREE.DirectionalLight(0x8080ff, 0.3);
                    fillLight.position.set(-5, -5, -5);
                    scene.add(fillLight);
                    lights.push(fillLight);
                }
                
                function renderMolecule(moleculeData) {
                    clearScene();
                    
                    moleculeData.atoms.forEach(function(atom) {
                        createAtom(atom);
                    });
                    
                    if (moleculeData.bonds) {
                        moleculeData.bonds.forEach(function(bond) {
                            createBond(bond, moleculeData.atoms);
                        });
                    }
                    
                    centerCamera();
                }
                
                function createAtom(atom) {
                    var radius = displayModel === 'space-filling' ? 
                        (atomicRadii[atom.element] || 1.0) * 0.5 : 
                        0.3;
                    
                    var geometry = new THREE.SphereGeometry(radius, 32, 32);
                    var material = new THREE.MeshPhongMaterial({
                        color: cpkColors[atom.element] || '#808080',
                        shininess: 100,
                        specular: 0x222222
                    });
                    
                    var mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(atom.position[0], atom.position[1], atom.position[2]);
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    mesh.userData = { type: 'atom', element: atom.element, id: atom.id };
                    
                    scene.add(mesh);
                    meshes.push(mesh);
                }
                
                function createBond(bond, atoms) {
                    var fromAtom = atoms.find(function(a) { return a.id === bond.from; });
                    var toAtom = atoms.find(function(a) { return a.id === bond.to; });
                    
                    if (!fromAtom || !toAtom) return;
                    
                    var fromPos = new THREE.Vector3(fromAtom.position[0], fromAtom.position[1], fromAtom.position[2]);
                    var toPos = new THREE.Vector3(toAtom.position[0], toAtom.position[1], toAtom.position[2]);
                    
                    var direction = new THREE.Vector3().subVectors(toPos, fromPos);
                    var length = direction.length();
                    var center = new THREE.Vector3().addVectors(fromPos, toPos).multiplyScalar(0.5);
                    
                    var radius = displayModel === 'space-filling' ? 0.1 : 0.15;
                    if (bond.type === 'double') radius *= 1.5;
                    if (bond.type === 'triple') radius *= 2;
                    
                    var geometry = new THREE.CylinderGeometry(radius, radius, length, 8);
                    var material = new THREE.MeshPhongMaterial({
                        color: 0x888888,
                        shininess: 50
                    });
                    
                    var mesh = new THREE.Mesh(geometry, material);
                    mesh.position.copy(center);
                    mesh.lookAt(toPos);
                    mesh.rotateX(Math.PI / 2);
                    mesh.userData = { type: 'bond', bondType: bond.type };
                    
                    scene.add(mesh);
                    meshes.push(mesh);
                }
                
                function renderAtom(elementData) {
                    clearScene();
                    
                    createNucleus(elementData);
                    createElectronShells(elementData);
                    
                    centerCamera();
                }
                
                function createNucleus(elementData) {
                    var nucleusRadius = 0.5;
                    var geometry = new THREE.SphereGeometry(nucleusRadius, 32, 32);
                    var material = new THREE.MeshPhongMaterial({
                        color: 0xff4444,
                        emissive: 0x220000,
                        shininess: 100
                    });
                    
                    var nucleus = new THREE.Mesh(geometry, material);
                    nucleus.position.set(0, 0, 0);
                    nucleus.userData = { type: 'nucleus' };
                    
                    scene.add(nucleus);
                    meshes.push(nucleus);
                }
                
                function createElectronShells(elementData) {
                    var shells = elementData.shells || [];
                    var shellColors = [0x4444ff, 0x44ff44, 0xffff45, 0xff44ff, 0x44ffff];
                    
                    shells.forEach(function(electronCount, shellIndex) {
                        if (electronCount === 0) return;
                        
                        var shellRadius = 1.5 + shellIndex * 1.2;
                        
                        var shellGeometry = new THREE.RingGeometry(shellRadius - 0.02, shellRadius + 0.02, 64);
                        var shellMaterial = new THREE.MeshBasicMaterial({
                            color: shellColors[shellIndex % shellColors.length],
                            opacity: 0.3,
                            transparent: true,
                            side: THREE.DoubleSide
                        });
                        
                        var shell = new THREE.Mesh(shellGeometry, shellMaterial);
                        shell.rotation.x = Math.PI / 2;
                        shell.userData = { type: 'shell', shellIndex: shellIndex };
                        
                        scene.add(shell);
                        meshes.push(shell);
                        
                        for (var i = 0; i < Math.min(electronCount, 8); i++) {
                            var angle = (i / electronCount) * Math.PI * 2;
                            var electronGeometry = new THREE.SphereGeometry(0.08, 8, 8);
                            var electronMaterial = new THREE.MeshPhongMaterial({
                                color: 0x00ffff,
                                emissive: 0x004444
                            });
                            
                            var electron = new THREE.Mesh(electronGeometry, electronMaterial);
                            electron.position.set(
                                shellRadius * Math.cos(angle),
                                0,
                                shellRadius * Math.sin(angle)
                            );
                            electron.userData = { 
                                type: 'electron', 
                                shellIndex: shellIndex,
                                angle: angle,
                                shellRadius: shellRadius
                            };
                            
                            scene.add(electron);
                            meshes.push(electron);
                        }
                    });
                }
                
                function clearScene() {
                    meshes.forEach(function(mesh) {
                        scene.remove(mesh);
                        if (mesh.geometry) mesh.geometry.dispose();
                        if (mesh.material) mesh.material.dispose();
                    });
                    meshes = [];
                }
                
                function centerCamera() {
                    if (meshes.length === 0) return;
                    
                    var box = new THREE.Box3();
                    meshes.forEach(function(mesh) { box.expandByObject(mesh); });
                    
                    var center = box.getCenter(new THREE.Vector3());
                    var size = box.getSize(new THREE.Vector3());
                    var maxDim = Math.max(size.x, size.y, size.z);
                    
                    meshes.forEach(function(mesh) { mesh.position.sub(center); });
                    
                    var distance = maxDim * 2;
                    camera.position.set(distance, distance, distance);
                    camera.lookAt(0, 0, 0);
                    controls.target.set(0, 0, 0);
                    controls.update();
                }
                
                function startAnimation() {
                    function animate() {
                        animationId = requestAnimationFrame(animate);
                        
                        if (isAutoRotating) {
                            meshes.forEach(function(mesh) {
                                if (mesh.userData.type === 'electron') {
                                    var time = Date.now() * 0.001;
                                    var angle = mesh.userData.angle + time * 0.5;
                                    mesh.position.x = mesh.userData.shellRadius * Math.cos(angle);
                                    mesh.position.z = mesh.userData.shellRadius * Math.sin(angle);
                                }
                            });
                        }
                        
                        controls.update();
                        renderer.render(scene, camera);
                    }
                    
                    animate();
                }
                
                function onWindowResize() {
                    var container = document.getElementById('viewerContainer');
                    var width = container.clientWidth;
                    var height = container.clientHeight;
                    
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                }
                
                window.addEventListener('resize', onWindowResize);
            }]);
        
        // ===== INITIALIZATION CALL =====
        angular.bootstrap(document, ['molecularVisualizer']);
    </script>
</body>
</html>
